{"version":3,"file":"validateStreamingLink.js","sources":["../../../music_app_frontend/src/validateStreamingLink.ts"],"sourcesContent":["//Create functions\nexport function getHostname(streamingLink: string): string | null {\n    //Check for empty input\n    if (!streamingLink) {\n        return null;\n    }\n\n    //Clean the input\n    const cleanedStreamingLink = streamingLink.trim();\n\n    //Parse URL\n    const url = URL.parse(cleanedStreamingLink);\n\n    //Return hostname if URL is valid\n    return url?.hostname ?? null;\n}\n\n//validateStreamingLink\nexport function checkStreamingLinkIsValid(hostName: string | null): null | string {\n    //Check if hostName is null or empty\n    if (!hostName) {\n        return \"The streaming link is empty. Please submit a valid link.\";\n    }\n\n    //Normalize: remove 'www.' prefix and convert to lowercase\n    const normalized = hostName.toLowerCase().replace(/^www\\./, '');\n\n    //Exact domain matches\n    const exactDomains = [\n        'youtube.com',\n        'youtu.be',\n        'music.youtube.com',\n        'm.youtube.com',\n        'bandcamp.com' // Main bandcamp site\n    ];\n\n    //Pattern matches for subdomains\n    const domainPatterns = [\n        /\\.bandcamp\\.com$/, //Matches artist.bandcamp.com, label.bandcamp.com\n        //TODO: Add patterns for soundcloud, nina\n    ];\n\n    //Check exact matches\n    if (exactDomains.includes(normalized)) {\n        return null;\n    }\n\n    //Check pattern matches\n    if (domainPatterns.some(pattern => pattern.test(normalized))) {\n        return null;\n    }\n\n    return \"The streaming link doesn't contain one of the supported platforms. Please submit a link from either YouTube or Bandcamp.\";\n}\n\n\n//orchestrateCheckStreamingLinkIsValid function\nexport function orchestrateCheckStreamingLinkIsValid(streamingLink: string | null): string | null {\n    //Check if streamingLink is null\n    if(!streamingLink) {\n        return 'The streaming link you have submitted is not valid. Please submit a valid link.'\n    };\n    \n    //Get hostname\n    const hostName = getHostname(streamingLink);\n    \n    //Check hostName is a supported platform \n    return checkStreamingLinkIsValid(hostName);\n};\n\n\n//Integrate into HTML page + Django form\ndocument.addEventListener(\"DOMContentLoaded\", (): void => {\n    //Define const variables\n    const form = document.getElementById(\"auth-form\") as HTMLFormElement;\n    const streamingLinkInput = document.getElementById(\"id_streaming_link\") as HTMLInputElement;\n    const streamlingLinkError = document.getElementById(\"streaming-link-error\") as HTMLDivElement;\n\n    //Check that all const exist\n    if (!form || !streamingLinkInput || !streamlingLinkError) {\n        console.warn(\"Required elements not found:\", {\n            form: !!form,\n            streamingLinkInput: !!streamingLinkInput,\n            streamlingLinkError: !!streamlingLinkError\n        });\n        return;\n    }\n\n    //Perform validation on form once user clicks \"submit\"\n    form.addEventListener(\"submit\", (event: SubmitEvent) => {\n        const error = orchestrateCheckStreamingLinkIsValid(streamingLinkInput.value);\n\n        if (error) {\n            event.preventDefault(); //stop the Django form submission\n            streamlingLinkError.textContent = error;\n        } else {\n            streamlingLinkError.textContent = \"\";\n        }\n    });\n})\n\n//check streaming plaform\nexport function supportedStreamingPlatformIsSelected(formDropDown: string): string[] {\n    const supportedPlatforms = [\n        \"youtube\",\n        \"youtube_music\",\n        \"bandcamp\",\n    ];\n\n    if (!supportedPlatforms.includes(formDropDown)) {\n        return [\"Please select a supported platform from the options below.\"];\n    }\n\n    return [];\n}\n\n\n//validateAddTrackForm\nexport function initValidateAddTrackForm(): void {\n    const form = document.getElementById(\"auth-form\") as HTMLFormElement | null;\n    const streamingPlatformInput =\n        document.getElementById(\"id_streaming_platform\") as HTMLSelectElement | null;\n    const streamingPlatformError =\n        document.getElementById(\"streaming-platform-error\") as HTMLDivElement | null;\n\n    if (!form || !streamingPlatformInput || !streamingPlatformError) {\n        console.warn(\"Critical form elements not found\");\n        return;\n    }\n\n    form.addEventListener(\"submit\", (event: SubmitEvent): void => {\n        console.log(\"TS submit handler fired\");\n        const errors = supportedStreamingPlatformIsSelected(\n            streamingPlatformInput.value\n        );\n\n        console.log(\"Streaming platform value:\", streamingPlatformInput.value);\n        console.log(\"Errors:\", errors);\n\n        if (errors.length > 0) {\n            event.preventDefault();\n            console.log(\"Preventing submission\");\n            streamingPlatformError.textContent = errors[0];\n        } else {\n            streamingPlatformError.textContent = \"\";\n        }\n    });\n    \n};\n\n\nconsole.log(\"validateStreamingLink initialized\")\n"],"names":["getHostname","streamingLink","cleanedStreamingLink","checkStreamingLinkIsValid","hostName","normalized","exactDomains","domainPatterns","pattern","orchestrateCheckStreamingLinkIsValid","form","streamingLinkInput","streamlingLinkError","event","error"],"mappings":"AACO,SAASA,EAAYC,EAAsC,CAE9D,GAAI,CAACA,EACD,OAAO,KAIX,MAAMC,EAAuBD,EAAc,KAAA,EAM3C,OAHY,IAAI,MAAMC,CAAoB,GAG9B,UAAY,IAC5B,CAGO,SAASC,EAA0BC,EAAwC,CAE9E,GAAI,CAACA,EACD,MAAO,2DAIX,MAAMC,EAAaD,EAAS,YAAA,EAAc,QAAQ,SAAU,EAAE,EAGxDE,EAAe,CACjB,cACA,WACA,oBACA,gBACA,cAAA,EAIEC,EAAiB,CACnB,kBAAA,EAUJ,OALID,EAAa,SAASD,CAAU,GAKhCE,EAAe,KAAKC,GAAWA,EAAQ,KAAKH,CAAU,CAAC,EAChD,KAGJ,0HACX,CAIO,SAASI,EAAqCR,EAA6C,CAE9F,GAAG,CAACA,EACA,MAAO,kFAIX,MAAMG,EAAWJ,EAAYC,CAAa,EAG1C,OAAOE,EAA0BC,CAAQ,CAC7C,CAIA,SAAS,iBAAiB,mBAAoB,IAAY,CAEtD,MAAMM,EAAO,SAAS,eAAe,WAAW,EAC1CC,EAAqB,SAAS,eAAe,mBAAmB,EAChEC,EAAsB,SAAS,eAAe,sBAAsB,EAG1E,GAAI,CAACF,GAAQ,CAACC,GAAsB,CAACC,EAAqB,CACtD,QAAQ,KAAK,+BAAgC,CACzC,KAAM,CAAC,CAACF,EACR,mBAAoB,CAAC,CAACC,EACtB,oBAAqB,CAAC,CAACC,CAAA,CAC1B,EACD,MACJ,CAGAF,EAAK,iBAAiB,SAAWG,GAAuB,CACpD,MAAMC,EAAQL,EAAqCE,EAAmB,KAAK,EAEvEG,GACAD,EAAM,eAAA,EACND,EAAoB,YAAcE,GAElCF,EAAoB,YAAc,EAE1C,CAAC,CACL,CAAC,EAoDD,QAAQ,IAAI,mCAAmC"}